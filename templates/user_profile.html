<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</title>
    <style>
body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background-color: #f9f9f9;
    max-width: 600px;
    margin: 0 auto;
    color: #333;
}

header {
    display: flex;
    justify-content: space-between; /* –†–∞–∑–º–µ—â–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ –∫—Ä–∞—è–º */
    align-items: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
}

h2 {
    color: #4CAF50;
    margin: 0;
}

h3 {
    margin-top: 30px;
    color: #333;
    font-size: 18px;
    text-align: center;
}

a {
    display: inline-block;
    text-align: center;
    margin-top: 0px;
    color: #af4c5b;
    text-decoration: none;
    padding: 10px 20px;
    border: 1px solid #af4c5b;
    border-radius: 5px;
    background-color: #fff;
}

a:hover {
    background-color: #af4c5b;
    color: white;
}

#profileInfo {
    background-color: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    margin-top: 20px;
}

#profileInfo p {
    font-size: 16px;
    margin-bottom: 10px;
    color: #555;
}

#profileInfo span {
    font-weight: bold;
    color: #333;
}

    </style>
</head>
<body>
    <header>
        <h2>+7{{ user.username }}</h2>
        <a id="logoutButton" href="{% url 'logout' %}">Logout</a>
    </header>
    
    <div id="inviteCodeInput" style="display: none;">
        <label for="inviteCodeInputField">–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥:</label>
        <input type="text" id="inviteCodeInputField" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥">
        <button id="submitCodeButton">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        <div id="activationStatus"></div>
    </div>
    <div id="codeActivated" style="display: none;">
        <p>–ö–æ–¥ üéâ<span id="activatedInviteCode"></span>üéâ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω üëç</p>
    </div>
    
    <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ñ–∏–ª–µ:</h3>
    <div id="profileInfo">
        <p>–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞: <span id="profilePhoneNumber"></span></p>
        <p>–°—Ç–∞—Ç—É—Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏: <span id="isVerified"></span></p>
        <p>–í–∞—à –∫–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è: <span id="inviteCode"></span></p>
        <p>–ü—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: <span id="invitedUsers"></span></p>
    </div>
    <script>
        // –ü–æ–ª—É—á–∞–µ–º username (–Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞) –∏–∑ —à–∞–±–ª–æ–Ω–∞ Django
        const phoneNumber = "{{ user.username }}";
        function getUserProfile(phoneNumber) {
            fetch(`/profile/?phone_number=${phoneNumber}`)
                .then(response => response.json())
                .then(data => {
                    if (data.activated_invite_code == null) {
                        document.getElementById('inviteCodeInput').style.display = 'block';
                        document.getElementById('codeActivated').style.display = 'none';
                    } else {
                        document.getElementById('codeActivated').style.display = 'block';
                        document.getElementById('inviteCodeInput').style.display = 'none';
                        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥
                        document.getElementById('activatedInviteCode').textContent = data.activated_invite_code;
                    }
                    if (data.phone_number) {
                        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                        document.getElementById('profilePhoneNumber').textContent = '+7' + data.phone_number;
                        document.getElementById('isVerified').textContent = data.is_verified ? '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω' : '–ù–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω';
                        document.getElementById('inviteCode').textContent = data.invite_code || '–ù–µ—Ç –∫–æ–¥–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è';
                        document.getElementById('invitedUsers').textContent = data.invited_users.length > 0 ? data.invited_users.join(', ') : '–ù–µ—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π';
                    } else {
                        console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è');
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è:', error);
                });
        }
        
        // –ü–æ–ª—É—á–∞–µ–º –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è
        getUserProfile(phoneNumber);
    </script>
    <script>
    // –ü–æ–ª—É—á–∞–µ–º CSRF —Ç–æ–∫–µ–Ω –∏–∑ cookies
    const getCookie = (name) => {
        let value = "; " + document.cookie;
        let parts = value.split("; " + name + "=");
        if (parts.length === 2) return parts.pop().split(";").shift();
    };
    const csrfToken = getCookie('csrftoken');
    </script>
    <script>
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
    function activateInviteCode(phoneNumber, inviteCode) {
        fetch('/activate_invite_code/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken  // –î–æ–±–∞–≤–ª—è–µ–º CSRF —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫
            },
            body: JSON.stringify({
                phone_number: phoneNumber,
                invite_code: inviteCode
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.message && data.message === 'Invite code activated successfully!') {
                // –ï—Å–ª–∏ –∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–∞–ª–æ—á–∫—É
                document.getElementById('activationStatus').innerHTML = '<span style="color: green;">‚úî –ö–æ–¥ —É—Å–ø–µ—à–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!</span>';
                location.reload(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∫–æ–¥–∞
            } else {
                // –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞, –≤—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                document.getElementById('activationStatus').innerHTML = '<span style="color: red;">–û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∫–æ–¥–∞</span>';
            }
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∫–æ–¥–∞:', error);
            document.getElementById('activationStatus').innerHTML = '<span style="color: red;">–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞</span>';
        });
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
    document.getElementById('submitCodeButton').addEventListener('click', () => {
        const inviteCode = document.getElementById('inviteCodeInputField').value.trim(); // –ü–æ–ª—É—á–∞–µ–º –≤–≤–µ–¥—ë–Ω–Ω—ã–π –∫–æ–¥
        if (inviteCode) {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏—é –∫–æ–¥–∞
            activateInviteCode(phoneNumber, inviteCode)
        } else {
            document.getElementById('activationStatus').innerHTML = '<span style="color: red;">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ–¥.</span>';
        }
    });
    </script>
</body>
</html>
